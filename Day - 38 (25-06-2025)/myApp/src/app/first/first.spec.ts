{
  "version": 3,
  "sources": ["angular:jit:template:src/app/products/products.html", "angular:jit:style:src/app/products/products.css", "src/app/models/cartItem.ts", "src/app/products/products.ts", "src/app/products/products.spec.ts"],
  "sourcesContent": ["<button type=\"button\" class=\"btn btn-primary\">\n  Notifications <span class=\"badge badge-light\">{{cartCount}}</span>\n</button>\n<input type=\"text\" [(ngModel)]=\"searchString\" (input)=\"handleSearchProducts()\"/>\n  <div>\n        @if (cartCount>0) {\n            @for (item of cartItems; track item.Id) {\n            <li>{{item.Id}} -- {{item.Count}}</li>\n            }\n        }\n  </div>\n\n\n@if (!loading) {\n    <div class=\"fade-in\">\n        @for (item of products; track item.id) {\n            <app-product (addToCart)=\"handleAddToCart($event)\" [product]=\"item\"></app-product>\n        }\n    </div>\n}\n@else {\n    <div>\n        <div class=\"spinner-border text-success\" role=\"status\">\n            <span class=\"sr-only\"></span>\n        </div>\n    </div>\n}\n", "/* src/app/products/products.css */\n.fade-in {\n  opacity: 0;\n  animation: fadeIn 01s ease-in forwards;\n}\n@keyframes fadeIn {\n  to {\n    opacity: 1;\n  }\n}\n/*# sourceMappingURL=products.css.map */\n", "export class CartItem{\n    constructor(public Id:Number=0,public Count:number=0)\n    {\n\n    }\n}", "import { Component, HostListener, OnInit } from '@angular/core';\nimport { ProductService } from '../services/product.service';\nimport { ProductModel } from '../models/product';\nimport { Product } from \"../product/product\";\nimport { CartItem } from '../models/cartItem';\nimport { FormsModule } from '@angular/forms';\nimport { debounce, debounceTime, distinctUntilChanged, Subject, switchMap, tap } from 'rxjs';\n\n\n\n@Component({\n  selector: 'app-products',\n  imports: [Product,FormsModule],\n  templateUrl: './products.html',\n  styleUrl: './products.css'\n})\nexport class Products implements OnInit {\n  products:ProductModel[]=[];\n  cartItems:CartItem[] =[];\n  cartCount:number =0;\n  searchString:string=\"\";\n  searchSubject = new Subject<string>();\n  loading:boolean = false;\n  limit=10;\n  skip=0;\n  total =0;\n  constructor(private productService:ProductService){\n\n  }\n  handleSearchProducts(){\n    // console.log(this.searchString)\n    this.searchSubject.next(this.searchString);\n  }\n\n\n  handleAddToCart(event:Number)\n  {\n    console.log(\"Handling add to cart - \"+event)\n    let flag = false;\n    for(let i=0;i<this.cartItems.length;i++)\n    {\n      if(this.cartItems[i].Id==event)\n      {\n         this.cartItems[i].Count++;\n         flag=true;\n      }\n    }\n    if(!flag)\n      this.cartItems.push(new CartItem(event,1));\n    this.cartCount++;\n  }\n  ngOnInit(): void {\n    // this.productService.getAllProducts().subscribe(\n    //   {\n    //     next:(data:any)=>{\n    //      this.products = data.products as ProductModel[];\n    //     },\n    //     error:(err)=>{},\n    //     complete:()=>{}\n    //   }\n    // )\n    this.searchSubject.pipe(\n      debounceTime(5000),\n      distinctUntilChanged(),\n      tap(()=>this.loading=true),\n      switchMap(query=>this.productService.getProductSearchResult(query,this.limit,this.skip)),\n       tap(()=>this.loading=false)).subscribe({\n        next:(data:any)=>{\n                    this.products = data.products as ProductModel[];\n                    this.total = data.total;\n                    console.log(this.total)\n                    }\n      });\n\n  }\n  @HostListener('window:scroll',[])\n  onScroll():void\n  {\n\n    const scrollPosition = window.innerHeight + window.scrollY;\n    const threshold = document.body.offsetHeight-100;\n    if(scrollPosition>=threshold && this.products?.length<this.total)\n    {\n      console.log(scrollPosition);\n      console.log(threshold)\n      \n      this.loadMore();\n    }\n  }\n  loadMore(){\n    this.loading = true;\n    this.skip += this.limit;\n    this.productService.getProductSearchResult(this.searchString,this.limit,this.skip)\n        .subscribe({\n          next:(data:any)=>{\n            [...this.products,...data.products]\n            this.loading = false;\n          }\n        })\n  }\n}\n", "import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\nimport { Products } from './products';\nimport { ProductService } from '../services/product.service';\nimport { FormsModule } from '@angular/forms';\nimport { of } from 'rxjs';\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\nimport { ProductModel } from '../models/product';\nimport { CartItem } from '../models/cartItem';\nimport { Component } from '@angular/core';\n\n// Stub for <app-product> (a standalone component import)\n@Component({\n  selector: 'app-product',\n  template: ''\n})\nclass MockProductComponent {}\n\ndescribe('Products Component (Standalone)', () => {\n  let component: Products;\n  let fixture: ComponentFixture<Products>;\n  let productServiceSpy: jasmine.SpyObj<ProductService>;\n\n  const dummyProductData = {\n    products: [\n      { id: 1, title: 'Phone' },\n      { id: 2, title: 'Laptop' }\n    ],\n    total: 20\n  };\n\n  beforeEach(async () => {\n    const spy = jasmine.createSpyObj('ProductService', ['getProductSearchResult']);\n\n    await TestBed.configureTestingModule({\n      imports: [Products, FormsModule], // Include Products component as standalone\n      providers: [{ provide: ProductService, useValue: spy }],\n      schemas: [CUSTOM_ELEMENTS_SCHEMA] // to ignore <app-product> if not mocked\n    }).compileComponents();\n\n    fixture = TestBed.createComponent(Products);\n    component = fixture.componentInstance;\n    productServiceSpy = TestBed.inject(ProductService) as jasmine.SpyObj<ProductService>;\n    productServiceSpy.getProductSearchResult.and.returnValue(of(dummyProductData));\n    fixture.detectChanges();\n  });\n\n  it('should create the component', () => {\n    expect(component).toBeTruthy();\n  });\n\n  it('should add new item to cart', () => {\n    component.handleAddToCart(1);\n    expect(component.cartItems.length).toBe(1);\n    expect(component.cartItems[0].Id).toBe(1);\n    expect(component.cartItems[0].Count).toBe(1);\n    expect(component.cartCount).toBe(1);\n  });\n\n  it('should increment item count if item already in cart', () => {\n    component.cartItems = [new CartItem(1, 1)];\n    component.cartCount = 1;\n    component.handleAddToCart(1);\n    expect(component.cartItems[0].Count).toBe(2);\n    expect(component.cartCount).toBe(2);\n  });\n\n  it('should debounce and search products', fakeAsync(() => {\n    component.searchString = 'mobile';\n    component.handleSearchProducts();\n\n    tick(5000); // debounceTime\n    fixture.detectChanges();\n\n    expect(productServiceSpy.getProductSearchResult).toHaveBeenCalledWith('mobile', 10, 0);\n    expect(component.products.length).toBe(2);\n    expect(component.total).toBe(20);\n  }));\n\n  it('should trigger loadMore on scroll near bottom', () => {\n    spyOn(component, 'loadMore');\n    spyOnProperty(window, 'innerHeight').and.returnValue(1000);\n    spyOnProperty(window, 'scrollY').and.returnValue(900);\n    Object.defineProperty(document.body, 'offsetHeight', { value: 1800 });\n\n    component.products = Array(10).fill({});\n    component.total = 20;\n\n    window.dispatchEvent(new Event('scroll'));\n    expect(component.loadMore).toHaveBeenCalled();\n  });\n\n  it('should load more products and update skip', () => {\n    const newProducts = {\n      products: [{ id: 3, title: 'Camera' }],\n      total: 20\n    };\n    productServiceSpy.getProductSearchResult.and.returnValue(of(newProducts));\n\n    component.products = [];\n    component.searchString = '';\n    component.skip = 0;\n\n    component.loadMore();\n    expect(productServiceSpy.getProductSearchResult).toHaveBeenCalledWith('', 10, 10);\n    expect(component.loading).toBeFalse();\n  });\n});\n"],
  "mappings": "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",
  "names": ["products_default", "init_products", "Products", "init_products"]
}
